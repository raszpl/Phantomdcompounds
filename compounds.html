<html><head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Phantom Doctrine compounds visual assistant.</title>

  <style type="text/css">
.stat { margin: 3px 0px 3px 0px; background: linear-gradient(135deg, #707070 0%,#0d0d0d 28%,#010101 50%,#0a0a0a 53%,#3d3d3d 76%,#262626 80%,#1b1b1b 100%); padding-left: 2px; padding-right: 2px; display: block; }
.prevstat { margin: 3px 0px 3px 0px; text-align: right; }
.stat input { background: unset; border-color: gray; color: white; width: 2em; text-align: right; }
.yellow { color: yellow !important; }
.sta { float: left;  width: 5.5em; height: 90%; margin: 5px 3px; }
.atribs { float: left; width: 24em; margin: 3px; }
.atribblock { float: left; width: 10em; margin: 3px 0px 3px 0px; }
.prevblock  { float: left; width: 2em; margin: 3px 0px 3px 0px; }

.drugs {
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -o-user-select: none;
    user-select: none;
    width: 100%;
}

.selected, .text {
    display:block;
    background-color:rgb(225, 225, 225);
}

.ui-widget {
    display: inline-block;
    font-size: small;
}

.threenumbers {
    width: 3.5ex;
    text-align: right;
}

.ui-widget-content {
    display: inline-block;
    border:1px dotted rgba(170, 170, 170, .25);
    margin:4px;
}

.components { height: 1em; }
.highlight { background: rgba(249, 229, 184, 0.98); }
.agent { height: 100px; width: auto;  background: black; color: lightgray; display: inline-block; }
.sep { height: 80%; float: left; width: 2px; background: gray; margin: 10px 1em 10px 1em; }
.points { float: right; color: white; }
.statup { color: rgba(60, 179, 121, 1); width: 2.5em; float: right; padding: 1px 2px 0px 2px; }
.statdown { color: red; width: 2.5em; float: right; padding: 1px 2px 0px 2px; }
.statsame { color: white; width: 2.5em; float: right; padding: 1px 2px 0px 2px; }
.prevup { color: rgba(60, 179, 121, 1); }
.prevdown { color: red;  }
.prevsame { color: white;  }
.arrow {float: left;}
.data {float: right;}
.hidden {visibility: hidden;}
.button { vertical-align: top; }
.buttonin { border-style: inset; }
.buttonout { border-style: outset; }

  </style>
</head>
<body>

<div>
 <label >Select progress</label>
<input type="range" id="range" value="10" min="0" max="10">
 <label for="ch">Chapter</label>
<select name="ch" id="chapter">
 <option>1 Part 1</option>
 <option selected="selected">1 Part 2</option>
 <option>2</option>
 <option>3 Part 1</option>
 <option>3 Part 2</option>
 <option>4 Part 1</option>
 <option>4 Part 2</option>
 <option>5</option>
 <option>6</option>
 <option>7 Part 1</option>
 <option>7 Part 2</option>
</select>
 <label>Available drugs:</label>
<div class="drugs">
 <span class="ui-widget-content compoundAMPEA">AMPEA</span>
 <span class="ui-widget-content compoundBMA">BMA</span>
 <span class="ui-widget-content compoundEPO">EPO</span>
 <span class="ui-widget-content compoundGonadorelin">Gonadorelin</span>
 <span class="ui-widget-content compoundBolasterone">Bolasterone</span>
 <span class="ui-widget-content compoundDanazol">Danazol</span>
 <span class="ui-widget-content compoundDXAMPEA">DXAMPEA</span>
 <span class="ui-widget-content compoundRaloxifene">Raloxifene</span>
 <span class="ui-widget-content compoundTST">TST</span>
 <span class="removeall">"Remove All"</span>
 <span class="ui-widget-content compoundARGOXY">ARGOXY</span>
 <span class="ui-widget-content compoundCyclofenil">Cyclofenil</span>
 <span class="ui-widget-content compoundDHEA">DHEA</span>
 <span class="ui-widget-content compoundFormebolone">Formebolone</span>
 <span class="ui-widget-content compoundAMPK">AMPK</span>
 <span class="ui-widget-content compoundBolandiol">Bolandiol</span>
 <span class="ui-widget-content compoundFGF">FGF</span>
 <span class="ui-widget-content compoundTHG">THG</span>
 <span class="ui-widget-content compoundAlbumin">Albumin</span>
 <span class="ui-widget-content compoundAnadrol">Anadrol</span>
 <span class="ui-widget-content compoundFormoterol">Formoterol</span>
 <span class="ui-widget-content compoundStanozolol">Stanozolol</span>
 <span class="ui-widget-content compoundCalusterone">Calusterone</span>
 <span class="ui-widget-content compoundMannitol">Mannitol</span>
 <span class="ui-widget-content compoundXENOXY">XENOXY</span>
 <span class="ui-widget-content compoundIGF">IGF-1</span>
</div>
</div>

<div class="agent">
<div class="sta">
<div class="stat">
 <label>Circulatory</label>
 <div>
  <input value="50" id="c" size="3" maxlength="3" type="text">
  <div class="statup hidden">
   <span class="arrow" id="previewa_c"></span>
   <span class="data" id="preview_c"></span>
  </div>
 </div>
</div>
<div class="stat">
 <label>Sensory</label>
 <div>
  <input value="50" id="s" size="3" maxlength="3" type="text">
  <div class="statup hidden">
   <span class="arrow" id="previewa_s"></span>
   <span class="data" id="preview_s"></span>
  </div>
 </div>
</div>
</div>
<div class="sta">
<div class="stat">
 <label>Respiratory</label>
 <div>
  <input value="50" id="r" size="3" maxlength="3" type="text">
  <div class="statup hidden">
   <span class="arrow" id="previewa_r"></span>
   <span class="data" id="preview_r"></span>
  </div>
 </div>
</div>
<div class="stat">
 <label>Motoric</label>
 <div>
  <input value="50" id="m" size="3" maxlength="3" type="text">
  <div class="statup hidden">
   <span class="arrow" id="previewa_m"></span>
   <span class="data" id="preview_m"></span>
  </div>
 </div>
</div>
</div>

<div class="sep"></div>

<div class="atribs">
<div class="atribblock">
<div class="stat">
 <span>Max Action Points</span>
 <span id="map" class="points">2</span>
</div>
<div class="stat">
 <span>Max Fire Points</span>
 <span id="mfp" class="points">1</span>
</div>
<div class="stat">
 <span>Damage Threshold</span>
 <span id="dt" class="points">0</span>
</div>
<div class="stat">
 <span>Dodge Cost</span>
 <span id="dc" class="points">35</span>
</div>
</div>


<div class="prevblock hidden">
<div class="prevstat">
 <span id="preview_map">2</span>
</div>
<div class="prevstat">
 <span id="preview_mfp">1</span>
</div>
<div class="prevstat">
 <span id="preview_dt">0</span>
</div>
<div class="prevstat">
 <span id="preview_dc">35</span>
</div>
</div>


<div class="atribblock">
<div class="stat">
 <span>Max Hit points</span>
 <span id="mhp" class="points">80</span>
</div>
<div class="stat">
 <span>Movement Range</span>
 <span id="mr" class="points">6</span>
</div>
<div class="stat">
 <span>Max Awareness</span>
 <span id="ma" class="points">70</span>
</div>
<div class="stat">
 <span>Awareness Regen</span>
 <span id="ar" class="points">20</span>
</div>
</div>

<div class="prevblock hidden">
<div class="prevstat">
 <span id="preview_mhp">2</span>
</div>
<div class="prevstat">
 <span id="preview_mr">1</span>
</div>
<div class="prevstat">
 <span id="preview_ma">0</span>
</div>
<div class="prevstat">
 <span id="preview_ar">35</span>
</div>
</div>



</div>

</div>
<button id="prev" class="button buttonin">Preview</button>
<button id="calc" class="button buttonin">Sort</button>

<!--
<button id='valid'>validate</button>
<button id='der'>derive</button>
<div id="chartContainer" style="height: 0px; width: 100%;"></div>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
-->
<div id="results"></div>

  <script type="text/javascript">
// ['compound', ['requires'], [blocks], [circulatory, sensory, respiratory, motoric], chapter]
druglist ={
  'AMPEA': [[], ['Calusterone'], [14, 7, 15, 8], 1],

  'BMA': [[], ['Danazol', 'AMPK'], [9, 15, 10, 16], 3],
  'EPO': [['AMPEA'], ['THG'], [13, 0, 0, -2], 3],
  'Gonadorelin': [[], ['Anadrol'], [2, 1, -4, 16], 3],

  'Bolasterone': [[], ['Stanozolol', 'Formoterol'], [-1, 11, 0, -1], 4],
  'Danazol': [['DXAMPEA'], ['FGF'], [-2, 0, 15, 2], 4],
  'DXAMPEA': [[], ['XENOXY', 'Albumin'], [8, 7, 11, 11], 4],

  'Raloxifene': [['ARGOXY'], ['DHEA'], [0, 19, -15, -10], 5],
  'TST': [[], ['Gonadorelin'], [7, 13, 15, 9], 5],

  'ARGOXY': [['EPO'], ['Formebolone'], [10, -1, 0, 0], 6],
  'Cyclofenil': [['Bolandiol'], ['Anadrol'], [18, -19, 29, 20], 6],
  'DHEA': [['BMA'], ['Formebolone'], [13, 12, 9, 19], 6],
  'Formebolone': [['Danazol'], ['DHEA'], [-1, 2, 10, 3], 6],

  'AMPK': [['Raloxifene'], ['BMA'], [22, 0, -10, 32], 7],
  'Bolandiol': [['Bolasterone'], ['FGF'], [-2, 8, 1, -3], 7],
  'FGF': [['Gonadorelin'], ['Raloxifene', 'Stanozolol'], [-5, 1, 3, 8], 7],
  'THG': [[], ['ARGOXY', 'Raloxifene'], [17, 17, 14, 8], 7],

  'Albumin': [['AMPK'], ['TST'], [-10, 24, 30, 6], 8],
  'Anadrol': [['TST'], ['Mannitol'], [17, 14, 11, 14], 8],
  'Formoterol': [['Formebolone', 'FGF'], ['AMPK'], [2, 0, 2, 14], 8],
  'Stanozolol': [['Formebolone'], ['Albumin'], [0, 0, 9, 5], 8],

  'Calusterone': [['Bolandiol'], ['Cyclofenil'], [0, 10, 0, -2], 9],
  'Mannitol': [['Danazol'], ['XENOXY'], [38, 24, 0, -10], 9],
  'XENOXY': [['ARGOXY'], ['Formoterol', 'TST'], [17, 0, 0, -4], 9],

  'IGF-1': [['Albumin'], ['Formoterol'], [-10, 19, 28, 31], 10]}

series =[
  //5 best, total, series:
  [[139,126,130,103,498], 'AMPEA', 'Bolasterone', 'Bolandiol', 'EPO', 'ARGOXY', 'Raloxifene', 'AMPK', 'TST', 'Albumin', 'IGF-1', 'XENOXY', 'DXAMPEA', 'Danazol', 'Mannitol', 'Anadrol', 'Cyclofenil'],
  [[149,119,130,89,487], 'DXAMPEA', 'Danazol', 'Mannitol', 'THG', 'TST', 'Anadrol', 'Bolasterone', 'Bolandiol', 'Cyclofenil', 'Calusterone', 'AMPEA', 'BMA', 'DHEA', 'EPO'],
  [[122,126,130,107,485], 'AMPEA', 'Bolasterone', 'Bolandiol', 'EPO', 'ARGOXY', 'Raloxifene', 'AMPK', 'TST', 'Albumin', 'DXAMPEA', 'Danazol', 'IGF-1', 'Mannitol', 'Anadrol', 'Cyclofenil'],
  [[149,109,130,91,479], 'AMPEA', 'DXAMPEA', 'Danazol', 'THG', 'EPO', 'Mannitol', 'TST', 'Anadrol', 'BMA', 'Bolasterone', 'Bolandiol', 'Cyclofenil', 'DHEA'],
  [[136,119,130,91,476], 'DXAMPEA', 'Danazol', 'Mannitol', 'THG', 'TST', 'Anadrol', 'Bolasterone', 'Bolandiol', 'Cyclofenil', 'Calusterone', 'AMPEA', 'BMA', 'DHEA'],
  //5 best, circulatory, series:
  [[159,83,72,66,380], 'AMPEA', 'Bolasterone', 'Bolandiol', 'EPO', 'ARGOXY', 'TST', 'XENOXY', 'DXAMPEA', 'Danazol', 'Mannitol', 'Anadrol', 'Cyclofenil', 'Raloxifene', 'AMPK'],
  [[159,110,101,69,439], 'AMPEA', 'Bolasterone', 'Bolandiol', 'EPO', 'ARGOXY', 'TST', 'XENOXY', 'DXAMPEA', 'Danazol', 'Mannitol', 'Anadrol', 'BMA', 'Cyclofenil', 'DHEA', 'Raloxifene'],
  [[159,91,116,79,445], 'AMPEA', 'Bolasterone', 'Bolandiol', 'EPO', 'ARGOXY', 'TST', 'XENOXY', 'DXAMPEA', 'Danazol', 'Mannitol', 'Anadrol', 'BMA', 'Cyclofenil', 'DHEA'],
  [[149,107,102,72,430], 'AMPEA', 'Bolasterone', 'Bolandiol', 'EPO', 'ARGOXY', 'Raloxifene', 'AMPK', 'TST', 'Albumin', 'XENOXY', 'DXAMPEA', 'Danazol', 'Mannitol', 'Anadrol', 'Cyclofenil'],
  [[149,119,130,89,487], 'DXAMPEA', 'Danazol', 'Mannitol', 'THG', 'TST', 'Anadrol', 'Bolasterone', 'Bolandiol', 'Cyclofenil', 'Calusterone', 'AMPEA', 'BMA', 'DHEA', 'EPO'],
  //5 best, sensory, series:
  [[121,155,101,81,458], 'Bolasterone', 'Bolandiol', 'Calusterone', 'AMPEA', 'EPO', 'ARGOXY', 'Raloxifene', 'AMPK', 'TST', 'Albumin', 'IGF-1', 'XENOXY', 'DXAMPEA', 'Danazol', 'Mannitol', 'Anadrol'],
  [[104,155,101,85,445], 'Bolasterone', 'Bolandiol', 'Calusterone', 'AMPEA', 'EPO', 'ARGOXY', 'Raloxifene', 'AMPK', 'TST', 'Albumin', 'DXAMPEA', 'Danazol', 'IGF-1', 'Mannitol', 'Anadrol'],
  [[104,145,101,87,437], 'AMPEA', 'Bolasterone', 'Bolandiol', 'EPO', 'ARGOXY', 'Raloxifene', 'AMPK', 'TST', 'Albumin', 'DXAMPEA', 'Danazol', 'IGF-1', 'Mannitol', 'Anadrol'],
  [[121,145,101,83,450], 'AMPEA', 'Bolasterone', 'Bolandiol', 'EPO', 'ARGOXY', 'Raloxifene', 'AMPK', 'TST', 'Albumin', 'IGF-1', 'XENOXY', 'DXAMPEA', 'Danazol', 'Mannitol', 'Anadrol'],
  [[106,142,86,83,417], 'Bolasterone', 'Bolandiol', 'Calusterone', 'AMPEA', 'EPO', 'ARGOXY', 'Gonadorelin', 'Raloxifene', 'AMPK', 'TST', 'Albumin', 'IGF-1', 'XENOXY', 'DXAMPEA', 'Danazol', 'Mannitol'],
  //5 best, respiratory, series:
  [[135,99,140,80,454], 'AMPEA', 'DXAMPEA', 'Danazol', 'THG', 'EPO', 'Mannitol', 'TST', 'Anadrol', 'BMA', 'Formebolone', 'Stanozolol', 'Bolasterone', 'Bolandiol', 'Cyclofenil'],
  [[122,99,140,82,443], 'AMPEA', 'DXAMPEA', 'Danazol', 'Mannitol', 'THG', 'TST', 'Anadrol', 'BMA', 'Formebolone', 'Stanozolol', 'Bolasterone', 'Bolandiol', 'Cyclofenil'],
  [[122,109,140,80,451], 'DXAMPEA', 'Danazol', 'Mannitol', 'THG', 'TST', 'Anadrol', 'BMA', 'Formebolone', 'Stanozolol', 'Bolasterone', 'Bolandiol', 'Cyclofenil', 'Calusterone', 'AMPEA'],
  [[97,75,140,90,402], 'AMPEA', 'TST', 'Anadrol', 'DXAMPEA', 'Danazol', 'BMA', 'THG', 'EPO', 'Formebolone', 'Stanozolol', 'Bolasterone', 'Bolandiol', 'Cyclofenil'],
  [[135,109,140,78,462], 'DXAMPEA', 'Danazol', 'Mannitol', 'THG', 'TST', 'Anadrol', 'BMA', 'Formebolone', 'Stanozolol', 'Bolasterone', 'Bolandiol', 'Cyclofenil', 'Calusterone', 'AMPEA', 'EPO'],
  //5 best, motoric, series:
  [[64,90,118,127,399], 'AMPEA', 'Bolasterone', 'EPO', 'ARGOXY', 'Gonadorelin', 'Raloxifene', 'AMPK', 'FGF', 'Bolandiol', 'Cyclofenil', 'TST', 'Albumin', 'DXAMPEA', 'Danazol', 'IGF-1'],
  [[66,90,103,125,384], 'AMPEA', 'Bolasterone', 'EPO', 'ARGOXY', 'Gonadorelin', 'Raloxifene', 'AMPK', 'FGF', 'Bolandiol', 'Cyclofenil', 'TST', 'Albumin', 'DXAMPEA', 'IGF-1'],
  [[81,90,118,123,412], 'AMPEA', 'Bolasterone', 'EPO', 'ARGOXY', 'Gonadorelin', 'Raloxifene', 'AMPK', 'FGF', 'Bolandiol', 'Cyclofenil', 'TST', 'Albumin', 'IGF-1', 'XENOXY', 'DXAMPEA', 'Danazol'],
  [[83,90,103,121,397], 'AMPEA', 'Bolasterone', 'EPO', 'ARGOXY', 'Gonadorelin', 'Raloxifene', 'AMPK', 'FGF', 'Bolandiol', 'Cyclofenil', 'TST', 'Albumin', 'IGF-1', 'XENOXY', 'DXAMPEA'],
  [[69,89,115,119,392], 'AMPEA', 'Bolasterone', 'Bolandiol', 'Cyclofenil', 'EPO', 'ARGOXY', 'Gonadorelin', 'Raloxifene', 'AMPK', 'TST', 'Albumin', 'DXAMPEA', 'Danazol', 'IGF-1'],
  //5 most, average, attributes, series:
  [[100,100,100,100,400], 'AMPEA', 'Bolasterone', 'Bolandiol', 'Cyclofenil', 'EPO', 'ARGOXY', 'Gonadorelin', 'Raloxifene', 'AMPK', 'Albumin', 'DXAMPEA', 'Danazol', 'IGF-1', 'Mannitol'],
  [[85,85,85,85,340], 'AMPEA', 'TST', 'Anadrol', 'BMA', 'DHEA', 'DXAMPEA', 'THG'],
  [[112,101,103,104,420], 'AMPEA', 'Bolasterone', 'EPO', 'ARGOXY', 'Gonadorelin', 'Raloxifene', 'AMPK', 'Albumin', 'FGF', 'Bolandiol', 'Cyclofenil', 'IGF-1', 'XENOXY', 'DXAMPEA', 'Danazol', 'Mannitol'],
  [[79,85,89,86,339], 'Bolasterone', 'Bolandiol', 'Cyclofenil', 'Calusterone', 'AMPEA', 'EPO', 'ARGOXY', 'Raloxifene', 'AMPK', 'Albumin', 'IGF-1', 'XENOXY', 'DXAMPEA'],
  [[64,68,62,67,261], 'AMPEA', 'DXAMPEA', 'Gonadorelin', 'FGF', 'Danazol', 'BMA', 'Formebolone', 'Formoterol', 'Bolasterone', 'Mannitol']]

sseries =[ // same as series, but sorted according to chapter drug availability order
  [[139,126,130,103,498], "AMPEA", "EPO", "Bolasterone", "TST", "ARGOXY", "Raloxifene", "AMPK", "Bolandiol", "Albumin", "XENOXY", "DXAMPEA", "Danazol", "Mannitol", "Anadrol", "Cyclofenil", "IGF-1"],
  [[149,119,130,89,487], "DXAMPEA", "Danazol", "BMA", "Bolasterone", "TST", "DHEA", "THG", "Bolandiol", "Mannitol", "Anadrol", "Cyclofenil", "Calusterone", "AMPEA", "EPO"],
  [[122,126,130,107,485], "AMPEA", "EPO", "Bolasterone", "TST", "ARGOXY", "Raloxifene", "AMPK", "Bolandiol", "Albumin", "DXAMPEA", "Danazol", "Mannitol", "Anadrol", "Cyclofenil", "IGF-1"],
  [[149,109,130,91,479], "AMPEA", "Bolasterone", "DXAMPEA", "Danazol", "BMA", "TST", "DHEA", "THG", "EPO", "Bolandiol", "Mannitol", "Anadrol", "Cyclofenil"],
  [[136,119,130,91,476], "Bolasterone", "DXAMPEA", "Danazol", "BMA", "TST", "DHEA", "Bolandiol", "THG", "Mannitol", "Anadrol", "Cyclofenil", "Calusterone", "AMPEA"],
  [[159,83,72,66,380], "AMPEA", "EPO", "Bolasterone", "TST", "ARGOXY", "Raloxifene", "Bolandiol", "AMPK", "XENOXY", "DXAMPEA", "Danazol", "Mannitol", "Anadrol", "Cyclofenil"],
  [[159,110,101,69,439], "AMPEA", "EPO", "Bolasterone", "TST", "ARGOXY", "Bolandiol", "XENOXY", "DXAMPEA", "Danazol", "BMA", "DHEA", "Raloxifene", "Mannitol", "Anadrol", "Cyclofenil"],
  [[159,91,116,79,445], "AMPEA", "EPO", "Bolasterone", "TST", "ARGOXY", "Bolandiol", "XENOXY", "DXAMPEA", "Danazol", "BMA", "DHEA", "Mannitol", "Anadrol", "Cyclofenil"],
  [[149,107,102,72,430], "AMPEA", "EPO", "Bolasterone", "TST", "ARGOXY", "Raloxifene", "AMPK", "Bolandiol", "Albumin", "XENOXY", "DXAMPEA", "Danazol", "Mannitol", "Anadrol", "Cyclofenil"],
  [[149,119,130,89,487], "DXAMPEA", "Danazol", "BMA", "Bolasterone", "TST", "DHEA", "THG", "Bolandiol", "Mannitol", "Anadrol", "Cyclofenil", "Calusterone", "AMPEA", "EPO"],
  [[121,155,101,81,458], "Bolasterone", "TST", "Bolandiol", "Calusterone", "AMPEA", "EPO", "ARGOXY", "Raloxifene", "AMPK", "Albumin", "XENOXY", "DXAMPEA", "Danazol", "Mannitol", "Anadrol", "IGF-1"],
  [[104,155,101,85,445], "Bolasterone", "TST", "Bolandiol", "Calusterone", "AMPEA", "EPO", "ARGOXY", "Raloxifene", "AMPK", "Albumin", "DXAMPEA", "Danazol", "Mannitol", "Anadrol", "IGF-1"],
  [[104,145,101,87,437], "AMPEA", "EPO", "Bolasterone", "TST", "ARGOXY", "Raloxifene", "AMPK", "Bolandiol", "Albumin", "DXAMPEA", "Danazol", "Mannitol", "Anadrol", "IGF-1"],
  [[121,145,101,83,450], "AMPEA", "EPO", "Bolasterone", "TST", "ARGOXY", "Raloxifene", "AMPK", "Bolandiol", "Albumin", "XENOXY", "DXAMPEA", "Danazol", "Mannitol", "Anadrol", "IGF-1"],
  [[106,142,86,83,417], "Gonadorelin", "Bolasterone", "TST", "Bolandiol", "Calusterone", "AMPEA", "EPO", "ARGOXY", "Raloxifene", "AMPK", "Albumin", "XENOXY", "DXAMPEA", "Danazol", "Mannitol", "IGF-1"],
  [[135,99,140,80,454], "AMPEA", "DXAMPEA", "Danazol", "BMA", "TST", "Formebolone", "THG", "EPO", "Stanozolol", "Bolasterone", "Bolandiol", "Mannitol", "Anadrol", "Cyclofenil"],
  [[122,99,140,82,443], "AMPEA", "DXAMPEA", "Danazol", "BMA", "TST", "Formebolone", "THG", "Stanozolol", "Bolasterone", "Bolandiol", "Mannitol", "Anadrol", "Cyclofenil"],
  [[122,109,140,80,451], "DXAMPEA", "Danazol", "BMA", "TST", "Formebolone", "THG", "Stanozolol", "Bolasterone", "Bolandiol", "Mannitol", "Anadrol", "Cyclofenil", "Calusterone", "AMPEA"],
  [[97,75,140,90,402], "AMPEA", "DXAMPEA", "Danazol", "BMA", "TST", "Formebolone", "THG", "EPO", "Stanozolol", "Bolasterone", "Bolandiol", "Anadrol", "Cyclofenil"],
  [[135,109,140,78,462], "DXAMPEA", "Danazol", "BMA", "TST", "Formebolone", "THG", "Stanozolol", "Bolasterone", "Bolandiol", "Mannitol", "Anadrol", "Cyclofenil", "Calusterone", "AMPEA", "EPO"],
  [[64,90,118,127,399], "AMPEA", "EPO", "Gonadorelin", "Bolasterone", "TST", "ARGOXY", "Raloxifene", "FGF", "Bolandiol", "Cyclofenil", "AMPK", "Albumin", "DXAMPEA", "Danazol", "IGF-1"],
  [[66,90,103,125,384], "AMPEA", "EPO", "Gonadorelin", "Bolasterone", "TST", "ARGOXY", "Raloxifene", "AMPK", "FGF", "Bolandiol", "Cyclofenil", "Albumin", "DXAMPEA", "IGF-1"],
  [[81,90,118,123,412], "AMPEA", "EPO", "Gonadorelin", "Bolasterone", "TST", "ARGOXY", "Raloxifene", "AMPK", "FGF", "Bolandiol", "Cyclofenil", "Albumin", "XENOXY", "DXAMPEA", "Danazol", "IGF-1"],
  [[83,90,103,121,397], "AMPEA", "EPO", "Gonadorelin", "Bolasterone", "TST", "ARGOXY", "Raloxifene", "AMPK", "FGF", "Bolandiol", "Cyclofenil", "Albumin", "XENOXY", "DXAMPEA", "IGF-1"],
  [[69,89,115,119,392], "AMPEA", "EPO", "Gonadorelin", "Bolasterone", "TST", "ARGOXY", "Raloxifene", "AMPK", "Bolandiol", "Cyclofenil", "Albumin", "DXAMPEA", "Danazol", "IGF-1"],
  [[100,100,100,100,400], "AMPEA", "EPO", "Gonadorelin", "Bolasterone", "ARGOXY", "Raloxifene", "AMPK", "Bolandiol", "Cyclofenil", "Albumin", "DXAMPEA", "Danazol", "Mannitol", "IGF-1"],
  [[85,85,85,85,340], "AMPEA", "BMA", "DXAMPEA", "TST", "DHEA", "THG", "Anadrol"],
  [[112,101,103,104,420], "AMPEA", "EPO", "Gonadorelin", "Bolasterone", "ARGOXY", "Raloxifene", "FGF", "Bolandiol", "Cyclofenil", "AMPK", "Albumin", "XENOXY", "DXAMPEA", "Danazol", "Mannitol", "IGF-1"],
  [[79,85,89,86,339], "Bolasterone", "Bolandiol", "Cyclofenil", "Calusterone", "AMPEA", "EPO", "ARGOXY", "Raloxifene", "AMPK", "Albumin", "XENOXY", "DXAMPEA", "IGF-1"],
  [[64,68,62,67,261], "AMPEA", "Gonadorelin", "DXAMPEA", "FGF", "Danazol", "Formebolone", "BMA", "Formoterol", "Bolasterone", "Mannitol"]]

  /* used to RE stats formulas
  derive =[
    //hammer
    [51,53,50,60,2,1,0,33,80,6,71,21],
  [104,100,93,118,3,1,4,22,107,7,95,26],
  [90,100,104,119,3,1,5,22,100,8,95,26],
  [91,85,112,110,3,1,6,23,100,8,87,26],
  [91,100,93,120,3,1,4,21,100,7,95,27],
  //canasta
  [95,93,94,75,2,1,4,30,102,7,91,22],
  [104,103,109,91,2,1,5,27,107,8,96,24],
  [103,104,101,86,2,1,5,28,106,8,97,23],
  [93,108,94,77,2,1,4,30,101,7,99,22],
  [95,78,113,65,2,1,6,32,102,8,84,21],
  [62,63,63,61,2,1,1,33,86,6,76,21],
  //durant
  [102,96,98,82,2,1,4,29,106,8,93,23],
  [111,106,113,98,2,1,6,26,110,8,98,24],
  [110,107,105,93,2,1,5,27,110,8,98,24],
  [100,111,98,84,2,1,4,29,105,8,100,23],
  [102,81,117,72,2,1,6,31,106,8,85,22],
  [69,66,67,68,2,1,1,32,89,6,78,21],
  //vulture
  [58,58,50,60,2,1,0,33,84,6,74,21],
  [72,73,57,68,2,1,0,32,91,6,81,21],
  [67,68,65,76,2,1,1,30,88,6,79,22],
  [66,69,57,71,2,1,0,31,88,6,79,22],
  [65,73,63,69,2,1,1,32,87,6,81,21],
  [71,58,50,58,2,1,0,34,90,6,74,20],
  [57,58,61,59,2,1,1,34,83,6,74,20],
  [56,73,50,62,2,1,0,33,83,6,81,21],
  [60,54,51,76,2,1,0,30,85,6,72,22],
  [58,43,69,50,2,1,1,35,84,7,67,20]]

var xx=0;
var yy=0;
var dps = [{x: 1, y: 10}, {x: 2, y: 10}, {x: 3, y: 10}, {x: 4, y: 10}, {x: 5, y: 10}];

var chart = new CanvasJS.Chart("chartContainer", {
	animationEnabled: false,
	toolTip:{
		shared: false
	},
    	axisY: {
		includeZero: false,
	},
	data: [{
		type: "column",
		dataPoints: dps
	}]
});
*/
let compoundcolor = "deepskyblue";
let eventc = new Event('change');
let eventi = new Event('input', {'bubbles': true,'cancelable': true});
let drugarray = [];
let css = '';
for (let key in druglist)
{
  css += '.compound'+key.replace( '-1', '' )+' {margin: 0px 2px 0px 2px;}';
  drugarray.push(key);
}
css += '.removeall {}';
let style = document.createElement('style');
style.type = 'text/css';
style.appendChild(document.createTextNode(css));
let head = document.head || document.getElementsByTagName('head')[0];
head.appendChild(style);

Array.prototype.forEach.call(document.getElementsByClassName("stat"), function (item) {
  item.oninput = function(e) {
    if (e.target && e.target.id)
    {
      switch(e.target.id)
      {
        case "m":
        case "c":
        case "r":
        case "s":
          applystats();
      }
    }
  }

  item.onmouseenter = function(e) {
    if (e.target.querySelector('input') && e.target.querySelector('input').id)
    {
      switch(e.target.querySelector('input').id)
      {
        case "m":
          ar.classList.add("yellow");
          dc.classList.add("yellow");
          map.classList.add("yellow");
          mr.classList.add("yellow");
          break;
        case "c":
          mhp.classList.add("yellow");
          mfp.classList.add("yellow");
          break;
        case "r":
          dt.classList.add("yellow");
          mr.classList.add("yellow");
          break;
        case "s":
          ma.classList.add("yellow");
          break;
      }
    }
  }

  item.onmouseleave = function(e) {
    if (e.target.querySelector('input') && e.target.querySelector('input').id)
    {
      switch(e.target.querySelector('input').id)
      {
        case "m":
          ar.classList.remove("yellow");
          dc.classList.remove("yellow");
          map.classList.remove("yellow");
          mr.classList.remove("yellow");
          break;
        case "c":
          mhp.classList.remove("yellow");
          mfp.classList.remove("yellow");
          break;
        case "r":
          dt.classList.remove("yellow");
          mr.classList.remove("yellow");
          break;
        case "s":
          ma.classList.remove("yellow");
          break;
      }
    }
  }

  /* used to RE stats formulas
  item.onclick = function(e) {
    if (e.target && e.target.id)
    {
      if (e.target.id.length==1)
      {
        xx = ["c","s","r","m","map","mfp","dt","dc","mhp","mr","ma","ar"].indexOf(e.target.id);
        results.innerHTML += e.target.id;
      }
      else
      {
        yy = ["c","s","r","m","map","mfp","dt","dc","mhp","mr","ma","ar"].indexOf(e.target.id);
        results.innerHTML += e.target.id;
      }
    }

    while(dps.length > 0) {
      dps.pop();
    }
    //dps= [];
    let x = 0;
    while (x < derive.length) {
      dps.push({x: derive[x][xx],y: derive[x][yy],});
      ++x;
    }
    chart.render();
  };
*/
})

function applystats(preview, hide) {
function updown(number, value, compare, clas, arrow) {
  let className;
  let arrowName;

  if (compare > 0)
  {
  className = "up";
  arrowName = "▲";
  }
  else if (compare < 0)
  {
  className = "down";
  arrowName = "▼";
  }
  else
  {
  className = "same";
  arrowName = "►";
  }

  number.innerText = value;
  number.parentNode.className = clas+className;
  if (arrow)
  {
    arrow.innerText = arrowName;
  }
}

  if (hide)
  {
    preview_c.parentNode.className ="statup hidden";
    preview_s.parentNode.className ="statup hidden";
    preview_r.parentNode.className ="statup hidden";
    preview_m.parentNode.className ="statup hidden";
    preview_map.parentNode.parentNode.className ="prevblock hidden";
    preview_mhp.parentNode.parentNode.className ="prevblock hidden";
  }
  else if (!preview)
  {
          //d(Awareness Regen) = d(Motoric-50) x 0.1 + 20
          ar.innerText = (parseInt(m.value)-50>0)? Math.floor((parseInt(m.value)-50) * 0.1 + 20) : Math.ceil((parseInt(m.value)-50) * 0.1 + 20);
          //d(Dodge Cost) = d(Motoric-50) x -0.2 + 35
          dc.innerText = Math.ceil(-(parseInt(m.value)-50) * 0.2 + 35);
          //(Max Action Points) Motoric tresholds 100, 140
          map.innerText = (parseInt(m.value)>=140) ? 4
          : (parseInt(m.value)>=100) ? 3
          : 2;
          //(Movement Range) Respiratory tresholds 68, 98, 130
          // 9 max? Max Action Points = 3 drops it down to 5, needs more research.
          mr.innerText = (map.innerText==3) ? 5
          : (parseInt(r.value)>=130) ? 9
          : (parseInt(r.value)>=98) ? 8
          : (parseInt(r.value)>=68) ? 7
          : 6;
          //d(Max Hit points) = d(Circulatory-50) x 0.5 + 80
          mhp.innerText = Math.floor((parseInt(c.value)-50) * 0.5 + 80);
          //(Max Fire Points) Circulatory tresholds 150, 200
          mfp.innerText = (parseInt(c.value)>=200) ? 3
          : (parseInt(c.value)>=150) ? 2
          : 1;
          //d(Damage Threshold) = d(Respiratory-50) x 0.1
          dt.innerText = Math.floor((parseInt(r.value)-50) * 0.1);
          //(Movement Range) Respiratory tresholds 68, 98, 130
          // 9 max? Max Action Points = 3 drops it down to 5, needs more research.
          mr.innerText = (map.innerText==3) ? 5
          : (parseInt(r.value)>=130) ? 9
          : (parseInt(r.value)>=98) ? 8
          : (parseInt(r.value)>=68) ? 7
          : 6;
          //d(Max Awareness) = d(Sensory-50) x 0.5 + 70
          ma.innerText = (parseInt(s.value)-50>0)? Math.floor((parseInt(s.value)-50) * 0.5 + 70) : Math.ceil((parseInt(s.value)-50) * 0.5 + 70);
  }
  else
  {
    let Circulatory = parseInt(c.value) + preview[0];
    updown(preview_c, Circulatory, Circulatory - parseInt(c.value), "stat", previewa_c);
    let Sensory = parseInt(s.value) + preview[1];
    updown(preview_s, Sensory, Sensory - parseInt(s.value), "stat", previewa_s);
    let Respiratory = parseInt(r.value) + preview[2];
    updown(preview_r, Respiratory, Respiratory - parseInt(r.value), "stat", previewa_r);
    let Motoric = parseInt(m.value) + preview[3];
    updown(preview_m, Motoric, Motoric - parseInt(m.value), "stat", previewa_m);

    preview_map.parentNode.parentNode.className = "prevblock";
    preview_mhp.parentNode.parentNode.className = "prevblock";

    let p_map = (Motoric>=140) ? 4
    : (Motoric>=100) ? 3
    : 2;
    updown(preview_map, p_map, p_map - parseInt(map.innerText), "prevstat prev");

    let p_mfp = (Circulatory>=200) ? 3
    : (Circulatory>=150) ? 2
    : 1;
    updown(preview_mfp, p_mfp, p_mfp - parseInt(mfp.innerText), "prevstat prev");

    let p_dt = Math.floor((Respiratory-50) * 0.1);
    updown(preview_dt, p_dt, p_dt - parseInt(dt.innerText), "prevstat prev");
    
    let p_dc = Math.ceil(-(Motoric-50) * 0.2 + 35);
    updown(preview_dc, p_dc, parseInt(dc.innerText) - p_dc, "prevstat prev");
    
    let p_mhp = Math.floor((Circulatory-50) * 0.5 + 80);
    updown(preview_mhp, p_mhp, p_mhp - parseInt(mhp.innerText), "prevstat prev");
    
    let p_mr = (map.innerText==3) ? 5
    : (Respiratory>=130) ? 9
    : (Respiratory>=98) ? 8
    : (Respiratory>=68) ? 7
    : 6;
    updown(preview_mr, p_mr, p_mr - parseInt(mr.innerText), "prevstat prev");
    
    let p_ma = (Sensory-50>0)? Math.floor((Sensory-50) * 0.5 + 70) : Math.ceil((Sensory-50) * 0.5 + 70);
    updown(preview_ma, p_ma, p_ma - parseInt(ma.innerText), "prevstat prev");
    
    let p_ar = (Motoric-50>0)? Math.floor((Motoric-50) * 0.1 + 20) : Math.ceil((Motoric-50) * 0.1 + 20);
    updown(preview_ar, p_ar, p_ar - parseInt(ar.innerText), "prevstat prev");
    
  }
}

function fillresults(components) {
var myDiv = document.getElementById("results");
myDiv.innerHTML ="";

for (let key in components)
{
  let div = document.createElement("div");
  div.className = "components";
  for (let key1 in components[key][0])
  {
    let thespan = document.createElement('span');
    thespan.className = "ui-widget threenumbers";
    thespan.innerText = components[key][0][key1];
    div.insertBefore(thespan, null );
    div.innerHTML += "|";
  }
  for (let key1 in components[key].slice(1))
  {
    let thespan = document.createElement('span');
    thespan.className = "ui-widget compound"+components[key].slice(1)[key1].replace( '-1', '' );
    thespan.innerText = components[key].slice(1)[key1];
    div.insertBefore(thespan, null );
    mousehandle(thespan);
  }
  div.onmouseover = function() {
    this.classList.add("highlight");
    let boost = [0,0,0,0];
    for (let key in [].slice.call(this.getElementsByClassName("threenumbers")).slice(0,4))
    {
      boost[key] = parseInt(this.getElementsByClassName("threenumbers")[key].innerText);
    }
    applystats(boost);
//    c.dispatchEvent(eventi);
//    s.dispatchEvent(eventi);
//    r.dispatchEvent(eventi);
//    m.dispatchEvent(eventi);
  }
  div.onmouseout = function() {
    this.classList.remove("highlight");
    applystats(0,"hide");
  }
  myDiv.appendChild(div);
}
}
fillresults(sseries);

calc.onclick = function() {
    if(calc.classList.contains("buttonin"))
    {
      calc.classList.remove("buttonin");
      calc.classList.add("buttonout");
      fillresults(series);
      recalculatecomponents();
    }
    else
    {
      calc.classList.remove("buttonout");
      calc.classList.add("buttonin");
      fillresults(sseries);
      recalculatecomponents();
    }
}

function mousehandle(thespan) {
    thespan.onmouseover = function() {
      style.sheet.rules[Object.keys(druglist).indexOf(this.innerText)].style.background = "lightgray";
      druglist[this.innerText][0].forEach(function(item) { //require
        style.sheet.rules[Object.keys(druglist).indexOf(item)].style.color = "green";
      })
      druglist[this.innerText][1].forEach(function(item) { //block
        style.sheet.rules[Object.keys(druglist).indexOf(item)].style.color = "red";
      })
    }
    thespan.onmouseout = function() {
      style.sheet.rules[Object.keys(druglist).indexOf(this.innerText)].style.background = "";
      for (let key in druglist)
      {
        if (druglist[key][4] == 0)
        {
          style.sheet.rules[Object.keys(druglist).indexOf(key)].style.color = compoundcolor;
        }
        else
        {
          style.sheet.rules[Object.keys(druglist).indexOf(key)].style.color ="";
        }
      }
    }
    thespan.onclick = function() {
      if (druglist[this.innerText][4])
      {
        style.sheet.rules[Object.keys(druglist).indexOf(this.innerText)].style.color = compoundcolor;
        druglist[this.innerText][4] = 0;
        recalculatecomponents();
      }
      else
      {
        style.sheet.rules[Object.keys(druglist).indexOf(this.innerText)].style.color ="";
        druglist[this.innerText][4] = 1;
        recalculatecomponents();
      }
    }
}

Array.prototype.forEach.call(document.getElementsByClassName("ui-widget-content"), function (item, index) {
mousehandle(item);
})

range.oninput = function() {
  chapter.selectedIndex = this.value;
  chapter.dispatchEvent(eventc);
}

chapter.onchange = function() {
  range.value = this.selectedIndex;
  for (let key in druglist)
  {
    if (druglist[key][3] > this.selectedIndex)
    {
      style.sheet.rules[Object.keys(druglist).indexOf(key)].style.color = compoundcolor;
      druglist[key][4] = 0;
    }
    else
    {
      style.sheet.rules[Object.keys(druglist).indexOf(key)].style.color ="";
      druglist[key][4] = 1;
    }
  }
  recalculatecomponents();
  if (5 > this.selectedIndex)
    {
      style.sheet.rules[drugarray.length].style.color = compoundcolor;
    }
    else
    {
      style.sheet.rules[drugarray.length].style.color ="";
    }
}
chapter.dispatchEvent(eventc);

prev.onclick = function() {
  if(prev.classList.contains("buttonin"))
  {
    prev.classList.remove("buttonin");
    prev.classList.add("buttonout");
    recalculatecomponents();
  }
  else
  {
    prev.classList.remove("buttonout");
    prev.classList.add("buttonin");
    recalculatecomponents();
  }
}

function recalculatecomponents() {
function addArrays(ar1, ar2){
    let ar3 = [];
    for(let i in ar1)
        ar3.push(ar1[i] + ar2[i]);
    return ar3;
}
  let components;
  let result = [0,0,0,0,0];
  if(calc.classList.contains("buttonout"))
  {
    components = series;
  }
  else
  {
    components = sseries;
  }
  
  for (let key in components)
  {
  if(prev.classList.contains("buttonout"))
  {
    for (let key1 in components[key][0])
    {
      result[key1] = components[key][0][key1];
    }
  }
  else
  {
    result = [0,0,0,0,0];
    for (let key1 in components[key].slice(1))
    {
      if (!druglist[components[key].slice(1)[key1]][4])
      {
        break;
      }
      result = addArrays(result, druglist[components[key].slice(1)[key1]][2]);
    }
    result[4] = result.slice(0,4).reduce((a, b) => a + b, 0);
  }

    let params = document.getElementsByClassName("components")[key].getElementsByClassName("threenumbers");
    params[0].innerText = result[0];
    params[1].innerText = result[1];
    params[2].innerText = result[2];
    params[3].innerText = result[3];
    params[4].innerText = result[4];
  }
}

/* used this one to generate sorted list

function generatesorted() {
  sizel = document.getElementsByClassName("components").length;
  for (let i = 0; i < sizel; ++i)
  {
    let sorted = series[i].slice(1).sort(function(a, b) {return druglist[a][3] - druglist[b][3]})

    let bad=1;
    while(bad)
    {
      bad=0;
      for (let key in sorted) {
        if (sorted.indexOf(druglist[sorted[key]][0][0]) > sorted.indexOf(sorted[key]))
        {
          sorted.splice(sorted.indexOf(druglist[sorted[key]][0][0]), 0, sorted.splice(sorted.indexOf(sorted[key]), 1)[0]);
          bad=1;
        }
        for (let key1 in druglist[sorted[key]][1])
        {
          if (sorted.indexOf(druglist[sorted[key]][1][key1]) > sorted.indexOf(sorted[key]))
          {
            sorted.splice(sorted.indexOf(druglist[sorted[key]][1][key1]), 0, sorted.splice(sorted.indexOf(sorted[key]), 1)[0]);
            bad=1;
          }
        }
      }
    }
    console.log(sorted);
  }
}

/* used to RE stats formulas
der.onclick = function(){}

function derx() {
  var dps = [];

  while (x < derive.length) {
    ble = derive[x];
    //  ble[11]-=10;
    //{ x: 6, y: 30 },
    //    results.innerHTML += "{ x: "+ble[2]+", y: "+ble[11]+" },<br>";
    dps.push({x: ble[2],y: ble[11],});
    ++x;
  }


  var chart = new CanvasJS.Chart("chartContainer", {
    animationEnabled: false,
    toolTip:{
      shared: false
    },
    data: [{
      type: "column",
      dataPoints: dps
    }]
  });

  chart.render();

};
*/

/* fail here
//valid.onclick = function(){}
function validx() {
  //results.innerText = JSON.stringify(permute(removeimpossible(perm),{},{},[]));
  results.innerText = series.length;
  results.innerHTML += "<br>";

  let x = 0;
  let i = 1;
  let blocks = [];

  //  while (x < 2) {
  while (x < series.length) {
    i = 1;
    blocks = [];
    while (i < series[x].length) {
      //results.innerHTML += series[x].slice(1, i+1)+"<br>";
      druglist[series[x][i]][1].forEach(function(item){
        //    results.innerHTML += series[x][i]+" blo: "+item+"<br>";
        if (!blocks.includes(item)) blocks.push(item);
      });

      if (!druglist[series[x][i]][0].every(function(item){return (series[x].slice(1, i+1).includes(item)); }))
      {
        results.innerHTML += "error req "+x+" "+i+"<br>";
      }
      if (blocks.includes(series[x][i]))
      {
        results.innerHTML += "error blo "+x+" "+i+" "+blocks+" "+series[x][i]+"<br>";
      }
      ++i;
    }
    ++x;
  }

}


function calcx(){
  function permute1(permutation) {
    let length = permutation.length,
        result = [permutation.slice()],
        c = new Array(length).fill(0),
        i = 1, k, p;

    while (i < length) {
      if (c[i] < i) {
        k = i % 2 && c[i];
        p = permutation[i];
        permutation[i] = permutation[k];
        permutation[k] = p;
        ++c[i];
        i = 1;
        result.push(permutation.slice());
      } else {
        c[i] = 0;
        ++i;
      }
    }
    return result;
  }

  function permute2(permutation) {
    function check(permutation) {
      let list = {},
          blocks = {},
          i = 0;

      while (i < permutation.length) {
        key = permutation[i];
        console.log(key, druglist[key][0], druglist[key][0][0], (druglist[key][0][0] && !(druglist[key][0] in list)), key in blocks);
        if ((druglist[key][0][0] && !(druglist[key][0] in list)))
        {
          let perm=[];
          for (let key in list) {
            perm.push(key);
          }
          return perm;
        }
        console.log("r");
        if (key in blocks)
        {
          let perm=[];
          for (let key in list) {
            perm.push(key);
          }
          return perm;
        }
        console.log("b");
        list[key] = 1;
        druglist[key][1].forEach(function(item)
                                 {
          blocks[item] = 1;
        });
        ++i;
        console.log(list,blocks);
      }

      return permutation;
    }

    let length = permutation.length,
        c = new Array(length).fill(0),
        result = [],
        i = 1, k, p;

    if (check(permutation))
    {
      result = [check(permutation).slice()];
    }


    while (i < length) {
      if (c[i] < i) {
        k = i % 2 && c[i];
        p = permutation[i];
        permutation[i] = permutation[k];
        permutation[k] = p;
        ++c[i];
        i = 1;

        if (check(permutation.slice()))
        {
          result.push(check(permutation).slice());
        }

      } else {
        c[i] = 0;
        ++i;
      }
    }
    return result;
  }

  function removeimpossible(permutation) {
    let i = 0;
    let perm = permutation.concat([]);

    while (i < perm.length) {
      if (!druglist[perm[i]][0].every(function(item){return (perm.includes(item)); }))
      {
        permutation.splice(i, 1)
      }
      ++i;
    }
    return permutation;
  }

  var x = 0;
  var result=[];

  function permute(permutation,required,blocks,list) {
    let perm=[],
        block=[],
        require=[],
        i = 0;

    while (i < permutation.length) {

      ++x;
      if (x > 4110) break;

      key = permutation[i];
      ++i;
      console.log("i",i-1);
      console.log("cal",permutation.length,permutation,"req:",required,"blo:",blocks);
      console.log("list",list);
      console.log("key", key, "req" ,druglist[key][0].length, druglist[key][0][0], "blo" ,druglist[key][1].length, druglist[key][1]);
      console.log("r?", (druglist[key][0].length && !(list.includes(druglist[key][0][0]))), "b?", key in blocks);

      if (druglist[key][0].length && !(list.includes(druglist[key][0][0])))
      {
        if (Object.keys(list).length &&(i-1 == permutation.length - 1))
        {
          console.log("r fail, pushing:",list.slice());
          result.push(list.slice());
        }
        continue;
      }
      if (key in blocks)
      {
        if (Object.keys(list).length &&(i-1 == permutation.length - 1))
        {
          console.log("b fail, pushing:",list.slice());
          result.push(list.slice());
        }
        continue;
      }
      //    list[key] = 1;
      //    blocks[key] = 1;
      require=[];
      druglist[key][0].forEach(function(item)
                               {
        require[item] = 1;
      });
      block=[];
      block[key] = 1;
      druglist[key][1].forEach(function(item)
                               {
        block[item] = 1;
      });
      console.log("block:",block);
      if (permutation.slice(0,i-1).concat(permutation.slice(i)).length)
      {
        console.log("concat:",i,permutation.slice(0,i-1).concat(permutation.slice(i)));
        permute(permutation.slice(0,i-1).concat(permutation.slice(i)), Object.assign({}, required, require), Object.assign({}, blocks, block), list.concat(key));
        //      result.push(key.split().concat(permute(permutation.slice(0,i-1).concat(permutation.slice(i)), Object.assign({}, required, require), Object.assign({}, blocks, block), list.concat(key))).slice());
      }

      if  (permutation.length == 1)
      {
        console.log("last ok, pushing:",list.concat(key).slice());
        result.push(list.concat(key).slice());
      }
    }


    console.log("res:",result,perm,list);
    return result.slice();
  }

  let perm = [];
  for (let key in druglist) {
    if (druglist[key][4])
    {
      perm.push(key);
    }
  }
  results.innerText = JSON.stringify(permute(removeimpossible(perm),{},{},[]));
  // console.table(permute(perm));
  // results.innerText = JSON.stringify(permute(["BMA", "AMPK"]));
};


function removeimpossible(permutation) {
  let i = 0;
  let perm = permutation.concat([]);

  while (i < perm.length) {
    if (!druglist[perm[i]][0].every(function(item){return (perm.includes(item)); }))
    {
      permutation.splice(i, 1)
    }
    ++i;
  }
}


var x = 0;
var result=[];

function permute(permutation,required,blocks,list) {
  let perm=[],
      block=[],
      require=[],
      i = 0;

  while (i < permutation.length) {

    ++x;
    if (x > 40) break;

    key = permutation[i];
    ++i;
    console.log("i",i-1);
    console.log("cal",permutation.length,permutation,"req:",required,"blo:",blocks);
    console.log("list",list);
    console.log("key", key, "req" ,druglist[key][0].length, druglist[key][0][0], "blo" ,druglist[key][1].length, druglist[key][1]);
    console.log("r?", (druglist[key][0].length && !(list.includes(druglist[key][0][0]))), "b?", key in blocks);

    if (druglist[key][0].length && !(list.includes(druglist[key][0][0])))
    {
      if (Object.keys(list).length)
      {
        console.log("r fail, pushing:",list.slice());
        result.push(list.slice());
      }
      continue;
    }
    if (key in blocks)
    {
      if (Object.keys(list).length)
      {
        console.log("b fail, pushing:",list.slice());
        result.push(list.slice());
      }
      continue;
    }
    //    list[key] = 1;
    //    blocks[key] = 1;
    require=[];
    druglist[key][0].forEach(function(item)
                             {
      require[item] = 1;
    });
    block=[];
    block[key] = 1;
    druglist[key][1].forEach(function(item)
                             {
      block[item] = 1;
    });
    console.log("block:",block);
    if (permutation.slice(0,i-1).concat(permutation.slice(i)).length)
    {
      console.log("concat:",i,permutation.slice(0,i-1).concat(permutation.slice(i)));
      permute(permutation.slice(0,i-1).concat(permutation.slice(i)), Object.assign({}, required, require), Object.assign({}, blocks, block), list.concat(key));
      //      result.push(key.split().concat(permute(permutation.slice(0,i-1).concat(permutation.slice(i)), Object.assign({}, required, require), Object.assign({}, blocks, block), list.concat(key))).slice());
    }

    if  (permutation.length == 1)
    {
      console.log("last ok, pushing:",list.concat(key).slice());
      result.push(list.concat(key).slice());
    }
  }


  console.log("res:",result,perm,list);
  return result.slice();
}
//aa = ["BMA", "AMPK", "DHEA", "DXAMPEA"];
//removeimpossible(aa);
//results.innerText = JSON.stringify(permute(aa,{},{},[]));
//console.table(permute(["BMA", "AMPK", "DHEA", "DXAMPEA"],{},{},[]));
*/

</script>

</body></html>